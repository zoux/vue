## 深入响应式原理

### 响应式对象

响应式对象核心就是利用 `Object.defineProperty` 给数据添加了 getter 和 setter。

#### initState

在 Vue 的初始化阶段，`_init` 方法执行的时候，会执行 `initState(vm)` 方法，主要是对 props、methods、data、computed 和 watcher 等属性做了初始化操作。

`initProps` 主要过程就是遍历定义的 props 配置。遍历的过程主要做两件事情：
1. 调用 `defineReactive` 方法把每个 prop 对应的值变成响应式，可以通过 `vm._props.xxx` 访问到定义 props 中对应的属性。
2. 通过 `proxy` 把 `vm._props.xxx` 的访问代理到 `vm.xxx` 上。

`initData` 主要过程也是遍历定义 data 函数的返回对象，遍历的过程主要做两件事：
1. 通过 `proxy` 把 `vm._data.xxx` 的访问代理到 `vm.xxx` 上。
2. 调用 `observe` 方法观测整个 data 的变化，把 data 也变成响应式，可以通过 `vm._data.xxx` 访问到定义 data 返回函数中对应的属性。

#### observe

`observe` 的功能就是用来监测数据的变化。通过给非 VNode 的对象类型数据添加一个 `Observer`，
如果已经添加过则直接返回，否则在满足一定条件下去实例化一个 `Observer` 对象实例。

#### Observer

`Observer` 是一个类，构造函数的逻首先实例化 `Dep` 对象，
然后根据 value 的类型做判断，对于数组会调用 `observeArray` 方法，否则对纯对象调用 walk 方法。
其中 `observeArray` 是遍历数组再次调用 `observe` 方法，而 `walk` 方法是遍历对象的 key 调用 `defineReactive` 方法。

#### defineReactive

`defineReactive` 函数最开始初始化 `Dep` 对象的实例，
接着拿到 obj 的属性描述符，
然后对子对象递归调用 `observe` 方法，
最后利用 `Object.defineProperty` 去给 obj 的属性 key 添加 getter 和 setter 来用于依赖收集和派发更新。


### 依赖收集


